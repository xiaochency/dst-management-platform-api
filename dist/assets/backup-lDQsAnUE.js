import{_ as ae,u as oe,a as le,g as ne,c as N,o as se,r as h,Z as g,B as i,d as ce,e as ie,f as t,w as a,p as q,j as l,i as u,m as p,t as s,s as ue,X as re,A as E,y,x as S,z as L,Y as de}from"./index-iCREqSRD.js";const me={class:"page-div"},pe={class:"card-header"},fe={style:{"margin-top":"20px"}},he={style:{"line-height":"50px"}},_e={style:{"line-height":"50px"}},ge={style:{"line-height":"50px"}},be={style:{"line-height":"50px"}},ve={class:"card-header"},ke=re({name:"toolsBackup"}),we=Object.assign(ke,{setup(ye){const{t:o}=oe(),{isMobile:x}=le(),F=ne(),P=N(()=>F.isDark),r=N(()=>F.language);se(()=>{v()});const B=h(!1),T=h(!1),V=h([]),_=h({enable:!1,time:"00:00:00"}),M=h(0),v=()=>{g.backup.get().then(e=>{V.value=e.data.backupFiles,_.value=e.data.backupSetting,M.value=e.data.diskUsage})},$=()=>{if(!_.value.time){E(o("tools.backup.timeChangeTip"));return}B.value=!0,T.value=!0;const e={time:_.value.time,enable:_.value.enable};g.backup.put(e).then(n=>{y(n.message)}).finally(()=>{B.value=!1,T.value=!1})},j=e=>{S.confirm(r.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",r.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:r.value==="zh"?"确定":"confirm",cancelButtonText:r.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(n,c,m)=>{if(n==="confirm"){c.confirmButtonLoading=!0;const f={name:e.name};g.backup.delete(f).then(k=>{y(k.message),m()}).catch(()=>{}).finally(()=>{c.confirmButtonLoading=!1,v()})}else m()}}).then(()=>{}).catch(()=>{L(o("home.canceled"))}).finally(()=>{b.value=!1})},A=e=>{S.confirm(r.value==="zh"?"将执行恢复操作，是否继续？":"The RESTORE operation will be performed. Do you want to continue?",r.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:r.value==="zh"?"确定":"confirm",cancelButtonText:r.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(n,c,m)=>{if(n==="confirm"){c.confirmButtonLoading=!0;const f={name:e.name};g.backupRestore.post(f).then(k=>{y(k.message),m()}).catch(()=>{}).finally(()=>{c.confirmButtonLoading=!1,v()})}else m()}}).then(()=>{}).catch(()=>{L(o("home.canceled"))}).finally(()=>{b.value=!1})},H=()=>{if(z.value.length===0){E(o("tools.backup.deleteTip"));return}S.confirm(r.value==="zh"?"将执行删除操作，是否继续？":"The DELETE operation will be performed. Do you want to continue?",r.value==="zh"?"请确认您的操作":"Please confirm your operation",{confirmButtonText:r.value==="zh"?"确定":"confirm",cancelButtonText:r.value==="zh"?"取消":"cancel",type:"warning",beforeClose:(e,n,c)=>{if(e==="confirm"){n.confirmButtonLoading=!0;const m={names:[]};for(let f of z.value)m.names.push(f.name);g.multiDelete.delete(m).then(f=>{y(f.message),c()}).catch(()=>{}).finally(()=>{n.confirmButtonLoading=!1,v()})}else c()}}).then(()=>{}).catch(()=>{L(o("home.canceled"))})},O=h(),z=h([]),X=e=>{z.value=e},Y=e=>{g.backupDownload.post({filename:e.name}).then(async n=>{await de(n.data,e.name)}).finally(()=>{b.value=!1})},b=h(!1),Z=e=>{let n=e.cmd,c=e.row;switch(b.value=!0,n){case"download":Y(c);break;case"restore":A(c);break;case"delete":j(c);break;default:b.value=!1,E("error")}},C=h(!1),G=()=>{C.value=!0,g.backup.post().then(e=>{y(e.message)}).finally(()=>{C.value=!1,v()})};return(e,n)=>{const c=i("el-button"),m=i("el-progress"),f=i("el-time-picker"),k=i("el-switch"),J=i("el-alert"),R=i("el-card"),I=i("el-col"),w=i("el-table-column"),K=i("arrow-down"),Q=i("el-icon"),D=i("el-dropdown-item"),W=i("el-dropdown-menu"),ee=i("el-dropdown"),te=i("el-table"),U=i("el-row");return ce(),ie("div",me,[t(U,{gutter:10},{default:a(()=>[t(I,{lg:12,md:12,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:a(()=>[t(R,{style:q(l(x)?"min-height: 500px":"min-height: 700px"),shadow:"never"},{header:a(()=>[u("div",pe,[p(s(l(o)("tools.backup.title1"))+" ",1),t(c,{loading:C.value,type:"primary",onClick:G},{default:a(()=>[p(s(l(o)("tools.backup.BackupImmediately")),1)]),_:1},8,["loading"])])]),default:a(()=>[u("div",null,[t(m,{percentage:parseFloat(M.value.toFixed(1))},{default:a(({percentage:d})=>[u("span",null,s(l(o)("tools.backup.processBar"))+s(d)+"%",1)]),_:1},8,["percentage"])]),u("div",fe,[u("div",he,[u("span",null,s(l(o)("tools.backup.text1")),1),t(f,{modelValue:_.value.time,"onUpdate:modelValue":n[0]||(n[0]=d=>_.value.time=d),clearable:!1,editable:!1,loading:B.value,style:{width:"120px",margin:"0 8px"},"value-format":"HH:mm:ss",onChange:$},null,8,["modelValue","loading"]),u("span",null,s(l(o)("tools.backup.text2")),1)]),u("div",_e,[u("span",null,s(l(o)("tools.backup.text3")),1),t(k,{modelValue:_.value.enable,"onUpdate:modelValue":n[1]||(n[1]=d=>_.value.enable=d),"active-text":e.$t("tools.backup.switchEnable"),"inactive-text":e.$t("tools.backup.switchDisable"),loading:T.value,"inline-prompt":"",style:{margin:"0 8px","--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},onChange:$},null,8,["modelValue","active-text","inactive-text","loading"])]),u("div",ge,[u("span",null,s(l(o)("tools.backup.text4")),1)]),u("div",be,[u("span",null,s(l(o)("tools.backup.text5")),1)])]),t(J,{closable:!1,effect:P.value?"light":"dark",style:{"margin-top":"20px"},type:"warning"},{default:a(()=>[p(s(l(o)("tools.backup.alert")),1)]),_:1},8,["effect"])]),_:1},8,["style"])]),_:1}),t(I,{lg:12,md:12,sm:24,span:24,xs:24,style:{"margin-top":"10px"}},{default:a(()=>[t(R,{style:q(l(x)?"min-height: 500px":"min-height: 700px"),shadow:"never"},{header:a(()=>[u("div",ve,[p(s(l(o)("tools.backup.title2"))+" ",1),t(c,{type:"danger",onClick:H},{default:a(()=>[p(s(l(o)("tools.backup.multiDelete")),1)]),_:1})])]),default:a(()=>[u("div",null,[t(U,null,{default:a(()=>[t(te,{ref_key:"tableRef",ref:O,data:V.value,"max-height":l(x)?450:550,border:"",onSelectionChange:X},{default:a(()=>[t(w,{fixed:"left",type:"selection",width:"55"}),t(w,{label:e.$t("tools.backup.tableName"),prop:"name"},null,8,["label"]),t(w,{label:e.$t("tools.backup.size"),prop:"size"},{default:a(d=>[p(s(l(ue)(d.row.size)),1)]),_:1},8,["label"]),t(w,{label:e.$t("tools.backup.tableCreateTime"),prop:"createTime"},null,8,["label"]),t(w,{label:e.$t("setting.button.actions"),prop:"actions",width:"120px"},{default:a(d=>[t(ee,{trigger:"click",onCommand:Z},{dropdown:a(()=>[t(W,null,{default:a(()=>[t(D,{command:{cmd:"download",row:d.row}},{default:a(()=>[p(s(l(o)("tools.backup.download")),1)]),_:2},1032,["command"]),t(D,{command:{cmd:"restore",row:d.row}},{default:a(()=>[p(s(l(o)("tools.backup.restore")),1)]),_:2},1032,["command"]),t(D,{command:{cmd:"delete",row:d.row}},{default:a(()=>[p(s(l(o)("tools.backup.delete")),1)]),_:2},1032,["command"])]),_:2},1024)]),default:a(()=>[t(c,{loading:b.value,link:"",type:"primary"},{default:a(()=>[p(s(l(o)("setting.button.actions"))+" ",1),t(Q,{class:"el-icon--right"},{default:a(()=>[t(K)]),_:1})]),_:1},8,["loading"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data","max-height"])]),_:1})])]),_:1},8,["style"])]),_:1})]),_:1})])}}}),Be=ae(we,[["__scopeId","data-v-ccaf6b47"]]);export{Be as default};
